<html>
  <head>
    <title>Embedded Webchat</title>
    <script src="tightrope_v1.js"></script>
  </head>

  <body>
    This is an example of embedded webchat
  </body>


  <script>
    const brokerageId = '5ce5d0ac9debbe001785f5b3';

    async function initializeBot() {
    return
    window.botpressWebChat.init({
      host: 'https://tightropechat.herokuapp.com',
      botName: 'TightropeBot',
      botConvoDescription: 'Is Tightrope right for you?',
      botId: 'learning',
      enableReset: false,
      showConversationsButton: false,
      extraStylesheet: 'https://chillbasslines.github.io/botpress-css/modern.css'
    })}; 

    async function setBrokerage() {window.botpressWebChat.sendEvent({
      type: 'set-brokerage',
      channel: 'web',
      brokerage: brokerageId
    })};

    let rand = Math.floor(Math.random() * 100000000);

    window.addEventListener('message', message => {
      const brokerageId = '5ce5d0ac9debbe001785f5b3';
      if (typeof message.data.userId !== 'undefined') {
        let id = message.data.userId;
        if(id.substr(id.length - 6) !== brokerageId.substr(brokerageId.length - 6)) {
          window.botpressWebChat.configure({
            userId: rand + brokerageId.substr(brokerageId.length - 6)
          })
        }
      }
    })
  </script>

</html>
