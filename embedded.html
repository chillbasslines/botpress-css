<html>
  <head>
    <title>Embedded Webchat</title>
    <script src="https://tightropechat.herokuapp.com/assets/modules/channel-web/inject.js"></script>
  </head>

  <body>
    This is an example of embedded webchat
  </body>


  <script>
    window.botpressWebChat.init({
      host: 'https://tightropechat.herokuapp.com',
      botName: 'YachtBot', 
      botConvoDescription: 'Let\'s find your perfect yacht',
      botId: 'learning',
      showConversationsButton: false,
      enableReset: true,
      showConversationsButton: false,
      extraStylesheet: 'https://chillbasslines.github.io/botpress-css/traditional.css'
    }) 
  </script>

  <script>
    let rand = Math.floor(Math.random() * 1000000000);
    const brokerageId = '5ceb22ec49c2610017bde272';
    setTimeout(function(){window.botpressWebChat.sendEvent({
      type: 'set-brokerage',
      channel: 'web',
      brokerage: brokerageId
    })}, 2000);
    window.addEventListener('message', message => {
      let id = message.data.userId;
      if(id.substr(id.length - 6) !== brokerageId.substr(brokerageId.length - 6)) {
        window.botpressWebChat.configure({
          host: 'https://tightropechat.herokuapp.com',
          botName: 'YachtBot', 
          botConvoDescription: 'Let\'s find your perfect yacht',
          botId: 'learning',
          extraStylesheet: 'https://chillbasslines.github.io/botpress-css/modern.css',
          userId: rand + brokerageId.substr(brokerageId.length - 6)
        })
      }
    })
  </script>

</html>
